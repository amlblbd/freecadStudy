
我来详细解释事务分组和多文档同步这两个高级概念。让我查看相关的实现代码。
        
            
toolName: search_codebase
            
status: success
          
query: FreeCAD transaction grouping multi-document synchronization same ID internal transaction ID cross-document undo redo together
          


​            
toolName: search_codebase
​            
status: success
​          
query: FreeCAD setActiveTransaction transaction ID cross-document same ID internal transaction management Application level
​          


​            
toolName: view_files
​            
status: success
​          
​            
filePath: e:/freeCAD/codes/FreeCAD/src/App/Document.pyi
​          


​            
toolName: search_codebase
​            
status: success
​          
query: FreeCAD Application setActiveTransaction transaction ID global management same ID cross-document undo redo together internal implementation
​          


​            
toolName: search_codebase
​            
status: success
​          
query: FreeCAD Application.h setActiveTransaction global transaction manager implementation same ID cross-document
​          


​            
toolName: search_codebase
​            
status: success
​          
query: FreeCAD Application setActiveTransaction global transaction manager implementation source code
​          
好的，我来详细解释事务分组和多文档同步这两个概念。

## 事务分组和多文档同步详解

### 1. 事务分组机制

**核心原理**：FreeCAD 使用全局事务管理器来协调多个文档的事务操作。

从代码分析可以看到：

```python
def openTransaction(self, name: str, /) -> None:
    """
    Open a new Undo/Redo transaction.

    This function no long creates a new transaction, but calls
    FreeCAD.setActiveTransaction(name) instead, which will auto creates a
    transaction with the given name when any change happened in any opened document.
    If more than one document is changed, all newly created transactions will have
    the same internal ID and will be undo/redo together.
    """
```

**工作流程**：

1. **设置活动事务**：调用 `FreeCAD.setActiveTransaction(name)` 设置全局活动事务
2. **延迟创建**：事务不会立即创建，而是在有实际变更时才创建
3. **统一ID**：如果多个文档都有变更，它们会共享相同的内部事务ID
4. **原子操作**：这些具有相同ID的事务会被视为一个整体，一起撤销或重做

### 2. 多文档同步实例

让我们看一个实际的测试用例：

```python
# 创建两个文档
self.Doc1 = FreeCAD.newDocument("Observer1")
self.Doc2 = FreeCAD.newDocument("Observer2")

# 启用撤销功能
self.Doc2.UndoMode = 1

# 设置活动文档
FreeCAD.setActiveDocument("Observer2")

# 开启事务
self.Doc2.openTransaction("test")
# 此时不会立即创建事务，而是设置pending状态

# 当有实际变更时，事务才会被创建
self.Doc2.addObject("App::FeatureTest", "test")
self.Doc2.commitTransaction()
```

### 3. 事务同步的关键特性

**相同内部ID**：当多个文档同时有变更时，系统会为它们分配相同的内部事务ID，确保它们可以一起被撤销或重做。

**全局协调**：通过 `FreeCAD.setActiveTransaction()` 实现全局级别的事务协调，而不是每个文档独立管理。

**延迟创建**：事务采用延迟创建策略，只有在实际发生变更时才真正创建事务对象。

### 4. 实际应用场景

想象一个复杂的装配操作：

1. 你在主文档中创建了一个零件
2. 同时在装配文档中引用了这个零件
3. 两个文档都有变更，但逻辑上这是一个操作
4. 系统会为这两个变更分配相同的事务ID
5. 当你撤销时，两个文档的变更会一起被撤销

这种机制确保了跨文档操作的完整性和一致性，让用户可以安全地进行复杂的多文档编辑操作。
        