# 项目架构分析

## 🏗️ 整体架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                           FreeCAD 应用程序                            │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐    │
│  │     GUI 层       │  │    Python API   │  │   工作台系统     │    │
│  │   (src/Gui)     │  │   (src/Mod)     │  │  (Workbench)    │    │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘    │
│           │                     │                     │             │
│  ┌────────┴─────────────────────┴─────────────────────┴────────┐    │
│  │                    核心应用层 (src/App)                     │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │    │
│  │  │  文档管理    │  │  对象系统    │  │  属性系统    │       │    │
│  │  │ (Document)   │  │ (Object)     │  │ (Property)   │       │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘       │    │
│  └──────────────────────────┬───────────────────────────────────┘    │
│                             │                                        │
│  ┌──────────────────────────┴───────────────────────────────────┐    │
│  │                    基础库层 (src/Base)                         │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │    │
│  │  │  控制台服务  │  │  参数系统    │  │  单位转换    │       │    │
│  │  │ (Console)    │  │ (Parameter)  │  │ (Units)      │       │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘       │    │
│  └──────────────────────────┬───────────────────────────────────┘    │
│                             │                                        │
│  ┌──────────────────────────┴───────────────────────────────────┐    │
│  │              第三方库和依赖 (src/3rdParty)                      │    │
│  │  OpenCASCADE (OCCT) │ Coin3D │ Qt │ Python │ Boost │         │    │
│  └──────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

## 📋 核心模块功能说明

### 1. **基础层 (Base)**

- **位置**: `src/Base/`
- **功能**: 提供FreeCAD的基础服务
- **核心组件**:
  - **Console**: 控制台服务，处理日志输出和错误报告
  - **Parameter**: 参数管理系统，保存用户偏好设置
  - **Units**: 单位转换和管理
  - **Python解释器**: 集成Python脚本引擎
  - **ProgressIndicator**: 进度指示器

### 2. **核心应用层 (App)**

- **位置**: `src/App/`
- **功能**: 应用程序核心逻辑
- **核心组件**:
  - **Application**: 主应用程序类，管理文档生命周期
  - **Document**: 文档管理系统，处理文件I/O
  - **DocumentObject**: 对象系统，所有CAD对象的基类
  - **Property**: 属性系统，管理对象属性
  - **Transaction**: 事务管理，支持撤销/重做
  - **Expression**: 表达式引擎，支持参数化建模

### 3. **图形界面层 (Gui)**

- **位置**: `src/Gui/`
- **功能**: 用户界面和3D可视化
- **核心组件**:
  - **MainWindow**: 主窗口管理
  - **3D View**: 三维视图渲染
  - **Tree View**: 对象树形结构显示
  - **Property Editor**: 属性编辑器
  - **Python Console**: Python控制台
  - **Task Panel**: 任务面板系统

### 4. **工作台系统 (Workbenches)**

- **位置**: `src/Mod/`
- **功能**: 专业化功能模块

#### 🔧 主要工作台：

| 工作台          | 功能描述              | 位置                  |
| --------------- | --------------------- | --------------------- |
| **Part**        | 基础几何建模，CSG操作 | `src/Mod/Part/`       |
| **Part Design** | 参数化特征建模        | `src/Mod/PartDesign/` |
| **Sketcher**    | 2D草图绘制            | `src/Mod/Sketcher/`   |
| **Assembly**    | 装配体设计            | `src/Mod/Assembly/`   |
| **BIM/Arch**    | 建筑信息建模          | `src/Mod/BIM/`        |
| **CAM**         | 计算机辅助制造        | `src/Mod/CAM/`        |
| **FEM**         | 有限元分析            | `src/Mod/Fem/`        |
| **Draft**       | 2D绘图工具            | `src/Mod/Draft/`      |
| **TechDraw**    | 技术制图              | `src/Mod/TechDraw/`   |
| **Mesh**        | 网格处理              | `src/Mod/Mesh/`       |

### 5. **扩展模块**

#### 📦 附加模块：

- **Addon Manager**: 插件管理器 (`src/Mod/AddonManager/`)
- **Material**: 材料数据库 (`src/Mod/Material/`)
- **Measure**: 测量工具 (`src/Mod/Measure/`)
- **Spreadsheet**: 电子表格 (`src/Mod/Spreadsheet/`)

#### 🔌 导入/导出模块：

- **Import**: 通用导入功能
- **OpenSCAD**: OpenSCAD文件支持
- **Points**: 点云处理
- **Reverse Engineering**: 逆向工程工具

### 6. **第三方依赖 (3rdParty)**

- **OpenCASCADE (OCCT)**: 几何内核
- **Coin3D**: 3D渲染引擎
- **Qt**: GUI框架
- **Python**: 脚本引擎
- **Boost**: C++库集合

## 🔄 数据流架构

```
用户界面 (GUI)
      ↕
工作台模块 (Workbenches)
      ↕
核心应用层 (App) ←→ 文档系统
      ↕
基础服务层 (Base)
      ↕
第三方库 (3rdParty)
```

## 🎯 架构特点

1. **模块化设计**: 清晰的分层架构，便于维护和扩展
2. **双API支持**: 同时提供C++和Python接口
3. **参数化建模**: 基于属性的对象系统
4. **事务管理**: 完整的撤销/重做机制
5. **扩展性**: 插件式工作台系统
6. **跨平台**: 基于Qt的跨平台GUI
7. **开源**: 完全开源的架构设计

这个架构使FreeCAD成为一个功能强大、可扩展的开源CAD平台，支持从简单的2D绘图到复杂的3D建模、装配和分析工作。
        
